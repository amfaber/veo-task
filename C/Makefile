# Makefile
# Almost entirely generated by GPT-4

CC=gcc
CFLAGS=-Iyahdlc/C -g
DEPS = yahdlc/C/yahdlc.h
OBJ = build/main.o build/yahdlc.o build/fcs.o

# Check for Windows and define clean command and Target
ifdef SystemRoot
	RM = del /Q
	MKDIR = if not exist $(@D) mkdir $(@D)
	RMDIR = rd /s /q
	TARGET = build/main.exe
	RUNTARGET = build/main.exe
else
	RM = rm -f
	MKDIR = mkdir -p $(@D)
	RMDIR = rm -rf
	TARGET = build/main
	RUNTARGET = build/main
endif

build/main.o: main.c $(DEPS)
	$(MKDIR)
	$(CC) -c -o $@ $< $(CFLAGS)

build/%.o: yahdlc/C/%.c $(DEPS)
	$(MKDIR)
	$(CC) -c -o $@ $< $(CFLAGS)

$(TARGET): $(OBJ)
	$(CC) -o $@ $^ $(CFLAGS)

.PHONY: clean

clean:
	$(RM) build\*.o
	$(RMDIR) build

run: $(TARGET)
	./$(RUNTARGET)

